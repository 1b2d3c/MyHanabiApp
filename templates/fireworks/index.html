{% extends 'fireworks/base.html' %}
{% load static %}

{% block title %}投稿一覧 - Firework App{% endblock %}

{% block content %}
    <h1 class="text-4xl font-extrabold mb-8 text-white text-center">みんなの投稿</h1>

    <!-- 投稿タイプによるフィルタリングボタン -->
    <div class="flex justify-center space-x-4 mb-8">
        <a href="{% url 'index' %}" class="px-6 py-3 rounded-full text-white font-medium transition-colors {% if not post_type_filter %}bg-pink-600{% else %}bg-gray-700 hover:bg-gray-600{% endif %}">
            すべて
        </a>
        <a href="{% url 'index' %}?post_type=program" class="px-6 py-3 rounded-full text-white font-medium transition-colors {% if post_type_filter == 'program' %}bg-pink-600{% else %}bg-gray-700 hover:bg-gray-600{% endif %}">
            プログラム
        </a>
        <a href="{% url 'index' %}?post_type=image" class="px-6 py-3 rounded-full text-white font-medium transition-colors {% if post_type_filter == 'image' %}bg-pink-600{% else %}bg-gray-700 hover:bg-gray-600{% endif %}">
            画像
        </a>
        <a href="{% url 'index' %}?post_type=video" class="px-6 py-3 rounded-full text-white font-medium transition-colors {% if post_type_filter == 'video' %}bg-pink-600{% else %}bg-gray-700 hover:bg-gray-600{% endif %}">
            動画
        </a>
        <a href="{% url 'index' %}?post_type=illustration" class="px-6 py-3 rounded-full text-white font-medium transition-colors {% if post_type_filter == 'illustration' %}bg-pink-600{% else %}bg-gray-700 hover:bg-gray-600{% endif %}">
            イラスト
        </a>
    </div>

    <!-- 投稿一覧グリッド -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for post in posts %}
        <div class="bg-gray-800 rounded-lg shadow-xl overflow-hidden transform hover:scale-105 transition-transform duration-300">
            {% if post.post_type == 'program' %}
                <div class="w-full h-64 bg-gray-900 flex items-center justify-center text-gray-500 text-lg relative">
                    <span class="absolute text-white top-2 left-2 px-2 py-1 bg-pink-500 rounded-md text-xs font-bold">プログラム</span>
                    <button class="play-button absolute" data-program-id="{{ post.firework_program.id }}">
                        <svg class="h-16 w-16 text-pink-400 hover:text-pink-300 transition-colors" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3.444-2a1 1 0 000-1.664l-3.444-2z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            {% elif post.file %}
                {% if post.post_type == 'image' or post.post_type == 'illustration' %}
                    <img src="{{ post.file.url }}" alt="{{ post.title }}" class="w-full h-64 object-cover cursor-pointer media-open" data-type="image" data-src="{{ post.file.url }}">
                {% elif post.post_type == 'video' %}
                    <video src="{{ post.file.url }}" controls class="w-full h-64 object-cover cursor-pointer media-open" data-type="video" data-src="{{ post.file.url }}"></video>
                {% endif %}
            {% else %}
                <div class="w-full h-64 bg-gray-900 flex items-center justify-center text-gray-500 text-lg">
                    コンテンツがありません
                </div>
            {% endif %}
            <div class="p-6">
                <h2 class="text-xl font-bold mb-2 text-white">{{ post.title }}</h2>
                <p class="text-gray-400 mb-4">{{ post.description|truncatechars:100 }}</p>
                <div class="flex justify-between items-center text-sm text-gray-500">
                    <span>投稿者: {{ post.user.username }}</span>
                    <span>{{ post.created_at|date:"Y/m/d" }}</span>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-center text-gray-400 col-span-full">まだ投稿がありません。</p>
        {% endfor %}
    </div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/player.js' %}"></script>
{% endblock %}

